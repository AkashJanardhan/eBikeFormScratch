<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>E-Bike Image Upload</title>
</head>
<body>

<h2>Upload E-Bike Image</h2>

<form id="uploadForm">
    <input type="file" id="imageFile" name="file">
    <button type="submit">Upload Image</button>
</form>

<script>
// Assuming you have an API endpoint from API Gateway
const apiEndpoint = 'https://4jyzsa7chd.execute-api.us-west-2.amazonaws.com/dev';

document.getElementById('uploadForm').onsubmit = async (e) => {
    e.preventDefault();
    
    const fileInput = document.getElementById('imageFile');
    if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        const filename = file.name;
        const timestamp = new Date().toISOString();
        const uniqueFilename = `${filename}-${timestamp}`;

        try {
            // Fetching a presigned URL from your API, including the filename in the request
            const response = await fetch(apiEndpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ filename: uniqueFilename })
            });

            const data = await response.json();
            const presignedUrl = data.url; // Ensure your API returns the presigned URL in this format
            const objectName = data.objectName; // Assuming your API also returns the final object name to be used
            console.log('Object name : " ${objectName}');

            // Use the presigned URL to upload the file directly to S3
            const uploadResponse = await fetch(presignedUrl, {
                method: 'PUT',
                headers: {
                    'Content-Type': file.type // Using the file's MIME type
                },
                body: file
            });

            if (uploadResponse.ok) {
                console.log('Image uploaded successfully.\n' + `Stored as: ${objectName}`)
                alert('Image uploaded successfully.\n' + `Stored as: ${objectName}`);
            } else {
                console.log('Failed to upload the image.')
                alert('Failed to upload the image.');
            }
        } catch (error) {
            console.error('Error uploading image:', error);
            alert('Error uploading the image.');
        }
    } else {
        alert('Please select a file to upload.');
    }
};
</script>

</body>
</html>
